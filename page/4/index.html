<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="article:author" content="sinaill">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/4/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/17/shiro%E9%AA%8C%E8%AF%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sinaill">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/17/shiro%E9%AA%8C%E8%AF%81/" itemprop="url">shiro验证</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-17T01:43:37+08:00">
                2020-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/shiro/" itemprop="url" rel="index">
                    <span itemprop="name">shiro</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="subject"><a href="#subject" class="headerlink" title="subject"></a>subject</h3><p>subject指的是:”当前正在执行的用户的特定的安全视图”,可以把Subject看成是shiro的”User”概念</p>
<h3 id="login"><a href="#login" class="headerlink" title="login"></a>login</h3><p>验证从调用subject的login方法开始</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;controller中</span><br><span class="line">Subject currentUser &#x3D; SecurityUtils.getSubject();</span><br><span class="line">if(!currentUser.isAuthenticated()) &#123;</span><br><span class="line">	UsernamePasswordToken token &#x3D; new UsernamePasswordToken(userName, password);</span><br><span class="line">	currentUser.login(token);</span><br></pre></td></tr></table></figure>

<p>进入login方法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Subject subject &#x3D; securityManager.login(this, token);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public Subject login(Subject subject, AuthenticationToken token) throws AuthenticationException &#123;</span><br><span class="line">    AuthenticationInfo info;</span><br><span class="line">    try &#123;</span><br><span class="line">        info &#x3D; authenticate(token);</span><br><span class="line">    &#125; catch (AuthenticationException ae) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            onFailedLogin(token, ae, subject);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            if (log.isInfoEnabled()) &#123;</span><br><span class="line">                log.info(&quot;onFailedLogin method threw an &quot; +</span><br><span class="line">                        &quot;exception.  Logging and propagating original AuthenticationException.&quot;, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        throw ae; &#x2F;&#x2F;propagate</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Subject loggedIn &#x3D; createSubject(token, info, subject);</span><br><span class="line"></span><br><span class="line">    onSuccessfulLogin(token, info, loggedIn);</span><br><span class="line"></span><br><span class="line">    return loggedIn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看<code>info = authenticate(token)</code>,可以看到这里抛出异常则验证失败</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public AuthenticationInfo authenticate(AuthenticationToken token) throws AuthenticationException &#123;</span><br><span class="line">    return this.authenticator.authenticate(token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在此处打断点debug可知调用以上方法的类实例为<code>org.apache.shiro.web.mgt.DefaultWebSecurityManager@5c2a5a3</code>，即在配置文件中已配置的</p>
<p>往下继续查看，类实例变为<code>org.apache.shiro.authc.pam.ModularRealmAuthenticator@10747cac</code>，也就是配置文件中的authenticator</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">info &#x3D; doAuthenticate(token);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  protected AuthenticationInfo doAuthenticate(AuthenticationToken authenticationToken) throws AuthenticationException &#123;</span><br><span class="line">      assertRealmsConfigured();</span><br><span class="line">&#x2F;&#x2F;获取authenticator中注入的realm</span><br><span class="line">      Collection&lt;Realm&gt; realms &#x3D; getRealms();</span><br><span class="line">      if (realms.size() &#x3D;&#x3D; 1) &#123;</span><br><span class="line">	&#x2F;&#x2F;配置单realm时进入此方法</span><br><span class="line">          return doSingleRealmAuthentication(realms.iterator().next(), authenticationToken);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">	&#x2F;&#x2F;多realm</span><br><span class="line">          return doMultiRealmAuthentication(realms, authenticationToken);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>还记得配置文件中，realm是可以注入在securitymanager中的，那这里是怎么获得authenticator中的realm呢，在authenticator中的<code>setRealms</code>方法打断点，debug之后发现，在初始化的时候shiro会将注入securitymanager中的realm通过set方法注入到authenticator中</p>
<p>进入<code>doSingleRealmAuthentication(realms.iterator().next(), authenticationToken);</code></p>
<p>调用了我们自定义realm的<code>getAuthenticationInfo(token)</code>方法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AuthenticationInfo info &#x3D; realm.getAuthenticationInfo(token);</span><br></pre></td></tr></table></figure>

<p>进入<code>getAuthenticationInfo(token)</code></p>
<p>在这个方法中，对密码进行匹配，失败时抛出异常，则登录验证失败</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public final AuthenticationInfo getAuthenticationInfo(AuthenticationToken token) throws AuthenticationException &#123;</span><br><span class="line"></span><br><span class="line">    AuthenticationInfo info &#x3D; getCachedAuthenticationInfo(token);</span><br><span class="line">    if (info &#x3D;&#x3D; null) &#123;</span><br><span class="line">        &#x2F;&#x2F;otherwise not cached, perform the lookup:</span><br><span class="line">        info &#x3D; doGetAuthenticationInfo(token);</span><br><span class="line">        log.debug(&quot;Looked up AuthenticationInfo [&#123;&#125;] from doGetAuthenticationInfo&quot;, info);</span><br><span class="line">        if (token !&#x3D; null &amp;&amp; info !&#x3D; null) &#123;</span><br><span class="line">            cacheAuthenticationInfoIfPossible(token, info);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        log.debug(&quot;Using cached authentication info [&#123;&#125;] to perform credentials matching.&quot;, info);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (info !&#x3D; null) &#123;</span><br><span class="line">        assertCredentialsMatch(token, info);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        log.debug(&quot;No AuthenticationInfo found for submitted AuthenticationToken [&#123;&#125;].  Returning null.&quot;, token);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">info &#x3D; doGetAuthenticationInfo(token);</span><br><span class="line">assertCredentialsMatch(token, info);</span><br></pre></td></tr></table></figure>
<p>第一条调用了我们自定义realm的doGetAuthenticationInfo(token)，就是需要我们覆写的方法</p>
<p>第二条对客户端传入的token和数据库取出的账号数据作匹配(即<code>doGetAuthenticationInfo(token)</code>方法的返回值</p>
<p>先查看<code>assertCredentialsMatch(token, info);</code>方法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">protected void assertCredentialsMatch(AuthenticationToken token, AuthenticationInfo info) throws AuthenticationException &#123;</span><br><span class="line">    CredentialsMatcher cm &#x3D; getCredentialsMatcher();</span><br><span class="line">    if (cm !&#x3D; null) &#123;</span><br><span class="line">        if (!cm.doCredentialsMatch(token, info)) &#123;</span><br><span class="line">            &#x2F;&#x2F;not successful - throw an exception to indicate this:</span><br><span class="line">            String msg &#x3D; &quot;Submitted credentials for token [&quot; + token + &quot;] did not match the expected credentials.&quot;;</span><br><span class="line">            throw new IncorrectCredentialsException(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        throw new AuthenticationException(&quot;A CredentialsMatcher must be configured in order to verify &quot; +</span><br><span class="line">                &quot;credentials during authentication.  If you do not wish for credentials to be examined, you &quot; +</span><br><span class="line">                &quot;can configure an &quot; + AllowAllCredentialsMatcher.class.getName() + &quot; instance.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>getCredentialsMatcher()</code>获取我们在配置文件中注入的<code>CredentialsMatcher</code>，此处配置的为<code>HashedCredentialsMatcher</code>，找到它的<code>doCredentialsMatch(token, info)</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public boolean doCredentialsMatch(AuthenticationToken token, AuthenticationInfo info) &#123;</span><br><span class="line">    Object tokenHashedCredentials &#x3D; hashProvidedCredentials(token, info);</span><br><span class="line">    Object accountCredentials &#x3D; getCredentials(info);</span><br><span class="line">    return equals(tokenHashedCredentials, accountCredentials);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>hashProvidedCredentials(token, info)</code>方法将我们传入的token，即客户端传来的账户信息，将其中密码加密</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">protected Hash hashProvidedCredentials(Object credentials, Object salt, int hashIterations) &#123;</span><br><span class="line">     String hashAlgorithmName &#x3D; assertHashAlgorithmName();</span><br><span class="line">     return new SimpleHash(hashAlgorithmName, credentials, salt, hashIterations);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>然后跟数据库取出的账户密码比对，所以数据库中的密码需是同种加密过</p>
<p>最后我们在看<code>info = doGetAuthenticationInfo(token);</code>当我们只需要验证而不需要授权时，定义realm的时候直接继承AuthenticatingRealm然后实现<code>doGetAuthenticationInfo</code>方法返回数据库中的账号信息，realm中的<code>etAuthenticationInfo</code>方法会调用<code>doGetAuthenticationInfo</code>验证账号信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class MyRealm extends AuthenticatingRealm &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected AuthenticationInfo doGetAuthenticationInfo(</span><br><span class="line">			AuthenticationToken token) throws AuthenticationException &#123;</span><br><span class="line">		&#x2F;&#x2F;第一个参数会存放在subject中，通过SecurityUtils.getSubject().getPrincipal()可取出</span><br><span class="line">		&#x2F;&#x2F;第二个参数为要匹配的密码，第三个盐值，第四个realm名</span><br><span class="line">		info &#x3D; new SimpleAuthenticationInfo(principle, credentials, credentialsSalt, realmName);</span><br><span class="line">		return info;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大致流程为subject.login-&gt;DefaultWebSecurityManager-&gt;ModularRealmAuthenticator-&gt;realm<br>主要验证过程是在realm的<code>getAuthenticationInfo</code>方法中</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/17/shiro%E6%8E%88%E6%9D%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sinaill">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/17/shiro%E6%8E%88%E6%9D%83/" itemprop="url">shiro授权</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-17T01:43:37+08:00">
                2020-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/shiro/" itemprop="url" rel="index">
                    <span itemprop="name">shiro</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="role和permission"><a href="#role和permission" class="headerlink" title="role和permission"></a>role和permission</h3><p>授权类型分为role和permission，角色和权限permission粒度更小，通常可以为user:XXXX</p>
<h3 id="AuthorizingRealm"><a href="#AuthorizingRealm" class="headerlink" title="AuthorizingRealm"></a>AuthorizingRealm</h3><p>需要用到授权时，我们的realm可以继承自这个类</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class ShiroRealm extends AuthorizingRealm&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>doGetAuthenticationInfo</code>用来验证</p>
<p><code>doGetAuthorizationInfo</code>用来授权</p>
<p>查看授权方法返回值AuthorizationInfo的实现类，其中</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">   public void setRoles(Set&lt;String&gt; roles) &#123;</span><br><span class="line">       this.roles &#x3D; roles;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public void addRole(String role) &#123;</span><br><span class="line">       if (this.roles &#x3D;&#x3D; null) &#123;</span><br><span class="line">           this.roles &#x3D; new HashSet&lt;String&gt;();</span><br><span class="line">       &#125;</span><br><span class="line">       this.roles.add(role);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public void addRoles(Collection&lt;String&gt; roles) &#123;</span><br><span class="line">       if (this.roles &#x3D;&#x3D; null) &#123;</span><br><span class="line">           this.roles &#x3D; new HashSet&lt;String&gt;();</span><br><span class="line">       &#125;</span><br><span class="line">       this.roles.addAll(roles);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public Set&lt;String&gt; getStringPermissions() &#123;</span><br><span class="line">       return stringPermissions;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public void addStringPermission(String permission) &#123;</span><br><span class="line">       if (this.stringPermissions &#x3D;&#x3D; null) &#123;</span><br><span class="line">           this.stringPermissions &#x3D; new HashSet&lt;String&gt;();</span><br><span class="line">       &#125;</span><br><span class="line">       this.stringPermissions.add(permission);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public void addStringPermissions(Collection&lt;String&gt; permissions) &#123;</span><br><span class="line">       if (this.stringPermissions &#x3D;&#x3D; null) &#123;</span><br><span class="line">           this.stringPermissions &#x3D; new HashSet&lt;String&gt;();</span><br><span class="line">       &#125;</span><br><span class="line">       this.stringPermissions.addAll(permissions);</span><br><span class="line">   &#125;</span><br><span class="line">·</span><br><span class="line">·</span><br><span class="line">·</span><br></pre></td></tr></table></figure>

<p>所以我们可以这样实现进行授权</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class ShiroRealm extends AuthorizingRealm&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException &#123;</span><br><span class="line">		</span><br><span class="line">		SimpleAuthorizationInfo info &#x3D; new SimpleAuthorizationInfo();</span><br><span class="line">		</span><br><span class="line">		info.addRole(&quot;admin&quot;);</span><br><span class="line"></span><br><span class="line">		info.addStringPermission(&quot;user:update&quot;)</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	return info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/17/set%E9%9B%86%E5%90%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sinaill">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/17/set%E9%9B%86%E5%90%88/" itemprop="url">set集合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-17T01:43:37+08:00">
                2020-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">java基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p><code>Set</code>集合中的元素是唯一的，不可重复（取决于<code>hashCode和equals</code>方法），也就是说具有唯一性。</p>
<p><code>Set</code>集合中元素不保证存取顺序，并不存在索引。</p>
<h3 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h3><p><code>HashSet</code>实际上是基于<code>HashMap</code>实现的，HashSet中有一成员变量</p>
<p><code>private transient HashMap&lt;E,Object&gt; map</code></p>
<p><code>HashSet</code>使用了<code>HashMap</code>的<code>key</code>来存储集合元素，也就是说<code>HashSet</code>可以存储一个<code>null</code>元素，并且不能有重复元素</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">private static final Object PRESENT &#x3D; new Object()</span><br><span class="line"></span><br><span class="line">   public boolean add(E e) &#123;</span><br><span class="line">       return map.put(e, PRESENT)&#x3D;&#x3D;null;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>由于<code>HashMap</code>的无序性，所以<code>HashSet</code>也是无序性的</p>
<h3 id="LinkedHashSet"><a href="#LinkedHashSet" class="headerlink" title="LinkedHashSet"></a>LinkedHashSet</h3><p><code>LinkedHashSet</code>是<code>HashSet</code>的一个子类，<code>LinkedHashSet</code>也根据<code>HashCode</code>的值来决定元素的存储位置，但同时它还用一个链表来维护元素的插入顺序，插入的时候既要计算<code>hashCode</code>还要维护链表，而遍历的时候只需要按照链表来访问元素。</p>
<p><code>LinkedHashSet</code>只有四个构造方法，构造方法调用了<code>HashSet</code>一个构造方法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HashSet(int initialCapacity, float loadFactor, boolean dummy) &#123;</span><br><span class="line">    map &#x3D; new LinkedHashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出，是基于<code>LinkedHashMap</code>实现，<code>HashSet</code>存储元素用的<code>HashMap</code>，而LinkedHashSet存储元素用的<code>LinkedHashMap</code>。</p>
<h3 id="TreeSet"><a href="#TreeSet" class="headerlink" title="TreeSet"></a>TreeSet</h3><p><code>TreeSet</code>是一个有序集合，本质上属于二叉树，实现了<code>SortedSet</code>接口所以具有了对元素排序的功能，要实现对元素的排序，需要在构造方法中传入一个<code>comparator</code>或者元素实现了<code>comparable</code>接口。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/17/only_full_group_by/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sinaill">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/17/only_full_group_by/" itemprop="url">group by关于sql_mode=only_full_group_by报错</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-17T01:43:37+08:00">
                2020-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="group-by作用"><a href="#group-by作用" class="headerlink" title="group by作用"></a>group by作用</h3><p>根据指定数段对查询结果进行分组</p>
<h3 id="sql-mode-only-full-group-by报错"><a href="#sql-mode-only-full-group-by报错" class="headerlink" title="sql_mode=only_full_group_by报错"></a>sql_mode=only_full_group_by报错</h3><p>对于GROUP BY聚合操作，如果在SELECT中的列，没有在GROUP BY中出现，那么这个SQL是不合法的，因为列不在GROUP BY从句中，也就是说查出来的列必须在group by后面出现否则就会报错，或者这个字段出现在聚合函数里面。</p>
<p>解决方法：关闭 only_full_group_by 模式或者使用any()或者其它聚合函数作用于不在group by后的字段</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set @@sql_mode&#x3D;&#39;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#39;;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/17/optional/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sinaill">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/17/optional/" itemprop="url">option接口</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-17T01:43:37+08:00">
                2020-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">java基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Optional是Java8提供的为了解决null安全问题的一个API，与String类似，也是final类型</p>
<h3 id="成员变量"><a href="#成员变量" class="headerlink" title="成员变量"></a>成员变量</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * Common instance for &#123;@code empty()&#125;.</span><br><span class="line"> *&#x2F;</span><br><span class="line">private static final Optional&lt;?&gt; EMPTY &#x3D; new Optional&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p>值为空的Optional共享此实例</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * If non-null, the value; if null, indicates no value is present</span><br><span class="line"> *&#x2F;</span><br><span class="line">private final T value;</span><br></pre></td></tr></table></figure>

<p>Optional类中用来存储值得变量</p>
<h3 id="成员方法"><a href="#成员方法" class="headerlink" title="成员方法"></a>成员方法</h3><h4 id="empty"><a href="#empty" class="headerlink" title="empty"></a>empty</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static&lt;T&gt; Optional&lt;T&gt; empty() &#123;</span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    Optional&lt;T&gt; t &#x3D; (Optional&lt;T&gt;) EMPTY;</span><br><span class="line">    return t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回类中定义好的空的Optional实例</p>
<h4 id="of"><a href="#of" class="headerlink" title="of"></a>of</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static &lt;T&gt; Optional&lt;T&gt; of(T value) &#123;</span><br><span class="line">    return new Optional&lt;&gt;(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>指定value返回一个Optional实例，若value为空，抛出空指针异常</p>
<h4 id="ofNullable"><a href="#ofNullable" class="headerlink" title="ofNullable"></a>ofNullable</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static &lt;T&gt; Optional&lt;T&gt; ofNullable(T value) &#123;</span><br><span class="line">    return value &#x3D;&#x3D; null ? empty() : of(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>指定value返回一个Optional实例，若value为空，则返回类中定义好的空的optional实例</p>
<h4 id="get"><a href="#get" class="headerlink" title="get"></a>get</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public T get() &#123;</span><br><span class="line">    if (value &#x3D;&#x3D; null) &#123;</span><br><span class="line">        throw new NoSuchElementException(&quot;No value present&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果 Optional中存在值，则返回值，否则抛出 NoSuchElementException </p>
<h4 id="isPresent"><a href="#isPresent" class="headerlink" title="isPresent"></a>isPresent</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public boolean isPresent() &#123;</span><br><span class="line">    return value !&#x3D; null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>值不为空时返回true，否则返回false</p>
<h4 id="ifPresent"><a href="#ifPresent" class="headerlink" title="ifPresent"></a>ifPresent</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public void ifPresent(Consumer&lt;? super T&gt; consumer) &#123;</span><br><span class="line">    if (value !&#x3D; null)</span><br><span class="line">        consumer.accept(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用consumer处理value，若consumer为空，抛出空指针异常</p>
<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public Optional&lt;T&gt; filter(Predicate&lt;? super T&gt; predicate) &#123;</span><br><span class="line">    Objects.requireNonNull(predicate);</span><br><span class="line">    if (!isPresent())</span><br><span class="line">        return this;</span><br><span class="line">    else</span><br><span class="line">        return predicate.test(value) ? this : empty();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>predicate接口处理value，返回true时，filter方法返回自身，返回false时，filter返回Optional中定义的空实例</p>
<h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public&lt;U&gt; Optional&lt;U&gt; map(Function&lt;? super T, ? extends U&gt; mapper) &#123;</span><br><span class="line">    Objects.requireNonNull(mapper);</span><br><span class="line">    if (!isPresent())</span><br><span class="line">        return empty();</span><br><span class="line">    else &#123;</span><br><span class="line">        return Optional.ofNullable(mapper.apply(value));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Function接口处理value，value为空时，返回Optional中定义的空实例。value不为空时，当Function中apply返回值为空时，也是返回空实例，否则以apply返回值创建Optional实例</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public&lt;U&gt; Optional&lt;U&gt; flatMap(Function&lt;? super T, Optional&lt;U&gt;&gt; mapper) &#123;</span><br><span class="line">    Objects.requireNonNull(mapper);</span><br><span class="line">    if (!isPresent())</span><br><span class="line">        return empty();</span><br><span class="line">    else &#123;</span><br><span class="line">        return Objects.requireNonNull(mapper.apply(value));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>与map方法类似，区别在于Function返回值，apply方法直接返回Optional实例</p>
<h4 id="orElse"><a href="#orElse" class="headerlink" title="orElse"></a>orElse</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public T orElse(T other) &#123;</span><br><span class="line">    return value !&#x3D; null ? value : other;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>value为空则返回other，否则返回value</p>
<h4 id="orElseGet"><a href="#orElseGet" class="headerlink" title="orElseGet"></a>orElseGet</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public T orElseGet(Supplier&lt;? extends T&gt; other) &#123;</span><br><span class="line">    return value !&#x3D; null ? value : other.get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>与orElse方法相同，参数变为Supplier接口实现。Optional.orElse(new class)与Optional.orElseGet(class:new)区别在于，orElseGet在value为空时才创建对象，而orElse一开始就创建了对象</p>
<h4 id="orElseThrow"><a href="#orElseThrow" class="headerlink" title="orElseThrow"></a>orElseThrow</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public &lt;X extends Throwable&gt; T orElseThrow(Supplier&lt;? extends X&gt; exceptionSupplier) throws X &#123;</span><br><span class="line">    if (value !&#x3D; null) &#123;</span><br><span class="line">        return value;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        throw exceptionSupplier.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>value为空时抛出自定义异常，否则返回value，value和Supplier的get方法返回值都为空时抛出空指针异常</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/17/semaphore/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sinaill">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/17/semaphore/" itemprop="url">semaphore</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-17T01:43:37+08:00">
                2020-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">java基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="semaphore"><a href="#semaphore" class="headerlink" title="semaphore"></a>semaphore</h3><p>java 1.5 后 引入Semaphore类</p>
<p>计数信号量(Counting Semaphore)用来控制同时访问某个特定资源的操作数量，或者同时执行某个指定操作的数量。计数信号量还可以用来实现某种资源池，或者对容器施加边界。</p>
<p>Semaphore中管理着一组虚拟的许可(permit)，许可的初始数量可通过构造函数来指定。在执行操作时可以首先获得许可(只要还有剩余的许可)，并在使用以后释放许可。如果没有许可，那么acquire将阻塞直到有许可(或者直到被中断或者操作超时)。release方法将返回一个许可给信号量。计算信号量的一种简化形式是二值信号量，即初始值为1的Semaphore。二值信号量可以用做互斥体(mutex)，并具备不可重入的加锁语义:谁拥有这个唯一的许可，谁就拥有了互斥锁。</p>
<p>概念上讲，一个信号量管理许多的许可证(permit)。为了通过信号量，线程通过调用<code>acquire</code>请求许可。其实没有实际的许可对象,信号量仅维护一个计数。许可的数目是固定的，由此限制了通过的线程数量。其他线程可以通过调用 <code>release</code>释放许可。而且，许可不是必须由获取它的线程释放。<strong>事实上，任何线程都可以释放任意数目的许可，这可能会增加许可数目以至于超出初始数目。</strong></p>
<h3 id="方法摘要"><a href="#方法摘要" class="headerlink" title="方法摘要"></a>方法摘要</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public Semaphore(int permits) &#123;</span><br><span class="line">    sync &#x3D; new NonfairSync(permits);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public Semaphore(int permits, boolean fair) &#123;</span><br><span class="line">    sync &#x3D; fair ? new FairSync(permits) : new NonfairSync(permits);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造方法，也分公平锁和非公平锁，公平锁遵循FIFO原则</p>
<ul>
<li><code>void acquire()</code></li>
</ul>
<p>从此信号量获取一个许可，在提供一个许可前一直将线程阻塞，否则线程被中断</p>
<ul>
<li><code>void release()</code></li>
</ul>
<p>释放一个许可，将其返回给信号量</p>
<ul>
<li><code>int availablePermits()</code></li>
</ul>
<p>返回此信号量中当前可用的许可数。</p>
<ul>
<li><code>boolean hasQueuedThreads()</code></li>
</ul>
<p>查询是否有线程正在等待获取</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="模拟加同步锁"><a href="#模拟加同步锁" class="headerlink" title="模拟加同步锁"></a>模拟加同步锁</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Store&#123;</span><br><span class="line">    private static int storage &#x3D; 0;</span><br><span class="line">    Semaphore semaphore &#x3D; new Semaphore(1);</span><br><span class="line">    public void add(int n) throws InterruptedException &#123;</span><br><span class="line">        semaphore.acquire();</span><br><span class="line">        storage +&#x3D; n;</span><br><span class="line">        semaphore.release();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void out()&#123;</span><br><span class="line">        System.out.println(storage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置信号量为1，这样可以保证多线程并发调用<code>add</code>方法时，只能单个线程运行，起到加锁效果</p>
<h4 id="生产者消费者模型"><a href="#生产者消费者模型" class="headerlink" title="生产者消费者模型"></a>生产者消费者模型</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">public class Test &#123; </span><br><span class="line">    int count &#x3D; 0; </span><br><span class="line">    final Semaphore put &#x3D; new Semaphore(5);&#x2F;&#x2F; 初始令牌个数 </span><br><span class="line">    final Semaphore get &#x3D; new Semaphore(0); </span><br><span class="line">    final Semaphore mutex &#x3D; new Semaphore(1); </span><br><span class="line"> </span><br><span class="line">    public static void main(String[] args) &#123; </span><br><span class="line">        Test t &#x3D; new Test(); </span><br><span class="line">        new Thread(t.new Producer()).start(); </span><br><span class="line">        new Thread(t.new Consumer()).start(); </span><br><span class="line">        new Thread(t.new Consumer()).start(); </span><br><span class="line">        new Thread(t.new Producer()).start(); </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    class Producer implements Runnable &#123; </span><br><span class="line">        @Override </span><br><span class="line">        public void run() &#123; </span><br><span class="line">            for (int i &#x3D; 0; i &lt; 5; i++) &#123; </span><br><span class="line">                try &#123; </span><br><span class="line">                    Thread.sleep(1000); </span><br><span class="line">                &#125; catch (Exception e) &#123; </span><br><span class="line">                    e.printStackTrace(); </span><br><span class="line">                &#125; </span><br><span class="line">                try &#123; </span><br><span class="line">                    put.acquire();&#x2F;&#x2F; 注意顺序 </span><br><span class="line">                    mutex.acquire(); </span><br><span class="line">                    count++; </span><br><span class="line">                    System.out.println(&quot;生产者&quot; + Thread.currentThread().getName() </span><br><span class="line">                            + &quot;已生产完成，商品数量：&quot; + count); </span><br><span class="line">                &#125; catch (Exception e) &#123; </span><br><span class="line">                    e.printStackTrace(); </span><br><span class="line">                &#125; finally &#123; </span><br><span class="line">                    mutex.release(); </span><br><span class="line">                    get.release(); </span><br><span class="line">                &#125; </span><br><span class="line"> </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    class Consumer implements Runnable &#123; </span><br><span class="line"> </span><br><span class="line">        @Override </span><br><span class="line">        public void run() &#123; </span><br><span class="line">            for (int i &#x3D; 0; i &lt; 5; i++) &#123; </span><br><span class="line">                try &#123; </span><br><span class="line">                    Thread.sleep(1000); </span><br><span class="line">                &#125; catch (InterruptedException e1) &#123; </span><br><span class="line">                    e1.printStackTrace(); </span><br><span class="line">                &#125; </span><br><span class="line">                try &#123; </span><br><span class="line">                    get.acquire();&#x2F;&#x2F; 注意顺序 </span><br><span class="line">                    mutex.acquire(); </span><br><span class="line">                    count--; </span><br><span class="line">                    System.out.println(&quot;消费者&quot; + Thread.currentThread().getName() </span><br><span class="line">                            + &quot;已消费，剩余商品数量：&quot; + count); </span><br><span class="line">                &#125; catch (Exception e) &#123; </span><br><span class="line">                    e.printStackTrace(); </span><br><span class="line">                &#125; finally &#123; </span><br><span class="line">                    mutex.release(); </span><br><span class="line">                    put.release(); </span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生产者受<code>put</code>初始信号量的限制，最多5个线程生产，生产完毕开始释放<code>get</code>信号量，虽然<code>get</code>信号量初始为0，但释放的信号量不受限制，所以生产完消费者线程开始消费，消费完毕又释放<code>put</code>信号量，启动生产</p>
<p>其中要注意<code>mutex</code>，初始信号量为1，即起到加锁效果，每次只能有一个线程运行，因为<code>count</code>为共享变量，还要注意<code>mutex</code>和<code>get</code>、<code>put</code>获取信号的顺序，<code>mute</code>确保只有本线程在运行，如果在<code>acquire</code>阻塞，将形成死锁</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/17/mysql%E4%BA%8B%E5%8A%A1%E5%92%8C%E9%94%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sinaill">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/17/mysql%E4%BA%8B%E5%8A%A1%E5%92%8C%E9%94%81/" itemprop="url">mysql事务和锁</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-17T01:43:37+08:00">
                2020-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="事务的基本要素-acid"><a href="#事务的基本要素-acid" class="headerlink" title="事务的基本要素(acid)"></a>事务的基本要素(acid)</h3><ol>
<li>原子性（Atomicity）：事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。</li>
<li>一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。</li>
<li>隔离性（Isolation）：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账。</li>
<li>持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。</li>
</ol>
<h3 id="事务的并发问题"><a href="#事务的并发问题" class="headerlink" title="事务的并发问题"></a>事务的并发问题</h3><ol>
<li>脏读：脏读意味着一个事务读取了另一个事务未提交的数据,而这个数据是有可能回滚</li>
<li>不可重复读：不可重复读意味着，在数据库访问中，一个事务范围内两个相同的查询却返回了不同数据。这是由于查询时系统中其他事务修改的提交而引起的。</li>
<li>幻读：是指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部数据行。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入一行新数据。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样.<br>不可重复读的和幻读很容易混淆，不可重复读侧重于修改，幻读侧重于新增或删除。解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表</li>
</ol>
<h3 id="mysql事务隔离级别"><a href="#mysql事务隔离级别" class="headerlink" title="mysql事务隔离级别"></a>mysql事务隔离级别</h3><p>mysql的事务默认级别是可重复读</p>
<table>
<thead>
<tr>
<th>事务隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>读未提交(read-uncommitted)</td>
<td>是</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>不可重复读(read-committed)</td>
<td>否</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>可重复读(repeatable-read)</td>
<td>否</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>串行化(serializable)</td>
<td>否</td>
<td>否</td>
<td>否</td>
</tr>
</tbody></table>
<p><a href="https://www.liaoxuefeng.com/wiki/1177760294764384/1219071817284064" target="_blank" rel="noopener">四种隔离级别测试</a></p>
<h3 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h3><p><a href="https://www.letiantian.me/mysql-innodb-rr-x-lock-example/" target="_blank" rel="noopener">共享锁，排他锁与事务</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/17/nio%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sinaill">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/17/nio%E5%9F%BA%E7%A1%80/" itemprop="url">nio基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-17T01:43:37+08:00">
                2020-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">java基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="什么是nio"><a href="#什么是nio" class="headerlink" title="什么是nio"></a>什么是nio</h3><p>Java NIO是java 1.4之后新出的一套IO接口，这里的的新是相对于原有标准的Java IO和Java Networking接口。NIO提供了一种完全不同的操作方式。</p>
<p><strong>NIO中的N可以理解为Non-blocking，不单纯是New</strong></p>
<p>标准的IO编程接口是面向字节流和字符流的。而NIO是面向通道和缓冲区的，数据总是从通道中读到buffer缓冲区内，或者从buffer写入到通道中</p>
<h3 id="nio核心组件"><a href="#nio核心组件" class="headerlink" title="nio核心组件"></a>nio核心组件</h3><h4 id="Channel通道"><a href="#Channel通道" class="headerlink" title="Channel通道"></a>Channel通道</h4><p>普通io是通过输入流和输出流来进行传输，nio只需要一个channel，channel是双向的，既可以写也可以读</p>
<p>特点</p>
<ul>
<li>通道可以读也可以写，流一般来说是单向的(只能读或者写)</li>
<li>通道可以异步读写</li>
<li>通道总是基于缓冲区Buffer来读写</li>
</ul>
<h4 id="Buffer缓冲区"><a href="#Buffer缓冲区" class="headerlink" title="Buffer缓冲区"></a>Buffer缓冲区</h4><p>Java NIO Buffers用于和NIO Channel交互，我们从channel中读取数据到buffers里，从buffer把数据写入到channels。</p>
<p>buffer中有三个属性，position，limit，capacity</p>
<ol>
<li>初始状态下，position为0，limit=capacity</li>
<li>使用put写入数据后，position为写入数据最后一个字节的索引(即写入数据的长度)</li>
<li>在读取buffer中数据或者向channel写入buffer，需要调用flip，作用是将<code>limit=position</code>,然后position归0，保证只作用于有效数据。</li>
</ol>
<h4 id="Selector选择器"><a href="#Selector选择器" class="headerlink" title="Selector选择器"></a>Selector选择器</h4><p>Selector是Java NIO中的一个组件，用于检查一个或多个NIO Channel的状态是否处于可读、可写。如此可以实现单线程管理多个channels,也就是可以管理多个网络链接。</p>
<h5 id="创建一个Selector"><a href="#创建一个Selector" class="headerlink" title="创建一个Selector"></a>创建一个Selector</h5><p><code>Selector selector = Selector.open();</code></p>
<h5 id="注册Channel到Selector上"><a href="#注册Channel到Selector上" class="headerlink" title="注册Channel到Selector上"></a>注册Channel到Selector上</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.configureBlocking(false);&#x2F;&#x2F;必须设置非阻塞通道</span><br><span class="line">SelectionKey key &#x3D; channel.register(selector, SelectionKey.OP_READ);</span><br></pre></td></tr></table></figure>

<p>register的第二个参数，这个参数是一个“关注集合”，代表我们关注的channel状态，有四种基础类型可供监听：</p>
<ul>
<li>Connect</li>
<li>Accept</li>
<li>Read</li>
<li>Write</li>
</ul>
<p>一个channel触发了一个事件也可视作该事件处于就绪状态。因此当channel与server连接成功后，那么就是“连接就绪”状态。server channel接收请求连接时处于“可连接就绪”状态。channel有数据可读时处于“读就绪”状态。channel可以进行数据写入时处于“写就绪”状态。</p>
<p>上述的四种就绪状态用SelectionKey中的常量表示如下：</p>
<ul>
<li>SelectionKey.OP_CONNECT</li>
<li>SelectionKey.OP_ACCEPT</li>
<li>SelectionKey.OP_READ</li>
<li>SelectionKey.OP_WRITE</li>
</ul>
<p>如果对多个事件感兴趣可利用位的或运算结合多个常量，比如：</p>
<p><code>int interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE;</code></p>
<h5 id="SelectionKey"><a href="#SelectionKey" class="headerlink" title="SelectionKey"></a>SelectionKey</h5><p>register方法把Channel注册到了Selectors上，这个方法的返回值是SelectionKey，这个返回的对象包含了以下属性：</p>
<ul>
<li>The interest set</li>
<li>The ready set</li>
<li>The Channel</li>
<li>The Selector</li>
<li>An attached object (optional)</li>
</ul>
<p>Interest Set实际上就是我们希望处理的事件的集合，它的值就是注册时传入的参数，我们可以用按为与运算把每个事件取出来：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int interestSet &#x3D; selectionKey.interestOps();</span><br><span class="line"></span><br><span class="line">boolean isInterestedInAccept  &#x3D; interestSet &amp; SelectionKey.OP_ACCEPT;</span><br><span class="line">boolean isInterestedInConnect &#x3D; interestSet &amp; SelectionKey.OP_CONNECT;</span><br><span class="line">boolean isInterestedInRead    &#x3D; interestSet &amp; SelectionKey.OP_READ;</span><br><span class="line">boolean isInterestedInWrite   &#x3D; interestSet &amp; SelectionKey.OP_WRITE;</span><br></pre></td></tr></table></figure>

<p>Ready Set中的值是当前channel处于就绪的值，为触发该channel的就绪状态</p>
<p><code>int readySet = selectionKey.readyOps();</code></p>
<p>Channel + Selector可以这样获得</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Channel  channel  &#x3D; selectionKey.channel();</span><br><span class="line">Selector selector &#x3D; selectionKey.selector();</span><br></pre></td></tr></table></figure>

<p>Attaching Objects，我们可以给一个SelectionKey附加一个Object，这样做一方面可以方便我们识别某个特定的channel，同时也增加了channel相关的附加信息。例如，可以把用于channel的buffer附加到SelectionKey上：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">selectionKey.attach(theObject);</span><br><span class="line"></span><br><span class="line">Object attachedObj &#x3D; selectionKey.attachment();</span><br></pre></td></tr></table></figure>

<p>附加对象的操作也可以在register的时候就执行：</p>
<p><code>SelectionKey key = channel.register(selector, SelectionKey.OP_READ, theObject);</code></p>
<h5 id="获取就绪channel"><a href="#获取就绪channel" class="headerlink" title="获取就绪channel"></a>获取就绪channel</h5><p>一旦我们向Selector注册了一个或多个channel后，就可以调用select来获取channel。select方法会返回所有处于就绪状态的channel。 select方法具体如下：</p>
<ul>
<li>int select()</li>
<li>int select(long timeout)</li>
<li>int selectNow()</li>
</ul>
<p>select()方法在返回channel之前处于阻塞状态。 select(long timeout)和select做的事一样，不过他的阻塞有一个超时限制。</p>
<p>selectNow()不会阻塞，根据当前状态立刻返回合适的channel。</p>
<p>select()方法的返回值是一个int整形，代表有多少channel处于就绪了。也就是自上一次select后有多少channel进入就绪。举例来说，假设第一次调用select时正好有一个channel就绪，那么返回值是1，并且对这个channel做任何处理，接着再次调用select，此时恰好又有一个新的channel就绪，那么返回值还是1，现在我们一共有两个channel处于就绪，但是在每次调用select时只有一个channel是就绪的。</p>
<p>在调用select并返回了有channel就绪之后，可以通过选中的key集合来获取channel，这个操作通过调用selectedKeys()方法：</p>
<p><code>Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();</code></p>
<p>还记得在register时的操作吧，我们register后的返回值就是SelectionKey实例，也就是我们现在通过selectedKeys()方法所返回的SelectionKey。</p>
<p>遍历这些SelectionKey可以通过如下方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Set&lt;SelectionKey&gt; selectedKeys &#x3D; selector.selectedKeys();</span><br><span class="line"></span><br><span class="line">Iterator&lt;SelectionKey&gt; keyIterator &#x3D; selectedKeys.iterator();</span><br><span class="line"></span><br><span class="line">while(keyIterator.hasNext()) &#123;</span><br><span class="line"></span><br><span class="line">    SelectionKey key &#x3D; keyIterator.next();</span><br><span class="line"></span><br><span class="line">    if(key.isAcceptable()) &#123;</span><br><span class="line">        &#x2F;&#x2F; a connection was accepted by a ServerSocketChannel.</span><br><span class="line"></span><br><span class="line">    &#125; else if (key.isConnectable()) &#123;</span><br><span class="line">        &#x2F;&#x2F; a connection was established with a remote server.</span><br><span class="line"></span><br><span class="line">    &#125; else if (key.isReadable()) &#123;</span><br><span class="line">        &#x2F;&#x2F; a channel is ready for reading</span><br><span class="line"></span><br><span class="line">    &#125; else if (key.isWritable()) &#123;</span><br><span class="line">        &#x2F;&#x2F; a channel is ready for writing</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    keyIterator.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于调用select而被阻塞的线程，可以通过调用Selector.wakeup()来唤醒即便此时已然没有channel处于就绪状态。具体操作是，在另外一个线程调用wakeup，被阻塞与select方法的线程就会立刻返回。</p>
<p>当操作Selector完毕后，需要调用close方法。close的调用会关闭Selector并使相关的SelectionKey都无效。channel本身不管被关闭。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/17/nio%E4%B8%8Eio%E7%AE%80%E5%8D%95%E8%81%8A%E5%A4%A9%E5%AE%A4demo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sinaill">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/17/nio%E4%B8%8Eio%E7%AE%80%E5%8D%95%E8%81%8A%E5%A4%A9%E5%AE%A4demo/" itemprop="url">nio与io简单聊天室demo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-17T01:43:37+08:00">
                2020-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">java基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="io聊天室demo"><a href="#io聊天室demo" class="headerlink" title="io聊天室demo"></a>io聊天室demo</h3><p>client端</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">	Socket Client &#x3D; new Socket(&quot;localhost&quot;, 8888);</span><br><span class="line">	DataInputStream dis &#x3D; new DataInputStream(Client.getInputStream());</span><br><span class="line">	DataOutputStream dos &#x3D; new DataOutputStream(Client.getOutputStream());</span><br><span class="line">	BufferedReader br &#x3D; new BufferedReader(new InputStreamReader(System.in));</span><br><span class="line">	&#x2F;&#x2F;开启一个线程用于读服务器传来的数据</span><br><span class="line">	new Thread(new Runnable() &#123;</span><br><span class="line">		@Override</span><br><span class="line">		public void run() &#123;</span><br><span class="line">			try &#123;</span><br><span class="line">				DataInputStream dis &#x3D; new DataInputStream(Client.getInputStream());</span><br><span class="line">				while (true) &#123;</span><br><span class="line">					String msgr &#x3D; dis.readUTF();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; catch (IOException e) &#123;</span><br><span class="line">				&#x2F;&#x2F; TODO Auto-generated catch block</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;).start();;</span><br><span class="line">	&#x2F;&#x2F;开启一个线程 用来读取键盘输入然后传输给服务器</span><br><span class="line">	new Thread(new Runnable() &#123;</span><br><span class="line">		</span><br><span class="line">		@Override</span><br><span class="line">		public void run() &#123;</span><br><span class="line">			String msg;</span><br><span class="line">			try &#123;</span><br><span class="line">				while (true) &#123;</span><br><span class="line">					</span><br><span class="line">					msg &#x3D; br.readLine();</span><br><span class="line">					dos.writeUTF(msg);</span><br><span class="line">					dos.flush();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; catch (IOException e) &#123;</span><br><span class="line">				&#x2F;&#x2F; TODO Auto-generated catch block</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;).start();;</span><br><span class="line">&#x2F;&#x2F;		dis.close();</span><br><span class="line">&#x2F;&#x2F;		dos.close();</span><br><span class="line">&#x2F;&#x2F;		br.close();</span><br><span class="line">&#x2F;&#x2F;		Client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>server端</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	List&lt;Socket&gt; sockets = <span class="keyword">new</span> ArrayList&lt;Socket&gt;();</span><br><span class="line">	ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">		Socket socket = server.accept();</span><br><span class="line">		sockets.add(socket);</span><br><span class="line">		<span class="comment">//由于io阻塞，每一个客户端连接都开启一个线程监听</span></span><br><span class="line">		<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			Socket mySocket = socket;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				DataInputStream dis = <span class="keyword">null</span>;</span><br><span class="line">				DataOutputStream dos = <span class="keyword">null</span>;</span><br><span class="line">				String name = <span class="string">""</span>;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					dis = <span class="keyword">new</span> DataInputStream(mySocket.getInputStream());</span><br><span class="line">					dos = <span class="keyword">new</span> DataOutputStream(mySocket.getOutputStream());</span><br><span class="line">					dos.writeUTF(<span class="string">"输入名字"</span>);</span><br><span class="line">					name = dis.readUTF();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">					String msg = <span class="string">""</span>;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						msg = dis.readUTF();</span><br><span class="line">						<span class="comment">//消息分发给其他客户端</span></span><br><span class="line">						<span class="keyword">for</span> (Socket socket : sockets) &#123;</span><br><span class="line">							<span class="keyword">if</span>(mySocket == socket) &#123;</span><br><span class="line">								<span class="keyword">continue</span>;</span><br><span class="line">							&#125;</span><br><span class="line">							dos = <span class="keyword">new</span> DataOutputStream(socket.getOutputStream());</span><br><span class="line">							dos.writeUTF(name+<span class="string">":"</span>+msg);</span><br><span class="line">							dos.flush();</span><br><span class="line">						&#125;</span><br><span class="line">					&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">					</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;).start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="nio聊天室demo"><a href="#nio聊天室demo" class="headerlink" title="nio聊天室demo"></a>nio聊天室demo</h3><p>client端</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		SocketChannel sc = SocketChannel.open();</span><br><span class="line">		sc.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">8888</span>));</span><br><span class="line">		Selector selector = Selector.open();</span><br><span class="line">		sc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">		sc.register(selector, SelectionKey.OP_READ);</span><br><span class="line"></span><br><span class="line">		BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">		ByteBuffer writeBuffer = ByteBuffer.allocate(<span class="number">50</span>);</span><br><span class="line">		ByteBuffer readBuffer = ByteBuffer.allocate(<span class="number">50</span>);</span><br><span class="line">		<span class="comment">//开启线程用于读取键盘输入然后写入服务器</span></span><br><span class="line">		<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">					String msg;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						msg = br.readLine();</span><br><span class="line">						writeBuffer.clear();</span><br><span class="line">						writeBuffer.put(msg.getBytes());</span><br><span class="line">						writeBuffer.flip();</span><br><span class="line">						sc.write(writeBuffer);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;).start();</span><br><span class="line">		<span class="comment">//selector监听channel</span></span><br><span class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">			selector.select();</span><br><span class="line">			Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();</span><br><span class="line">			Iterator&lt;SelectionKey&gt; it = selectedKeys.iterator();</span><br><span class="line">			<span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">				SelectionKey selectionKey = (SelectionKey) it.next();</span><br><span class="line">				<span class="keyword">if</span> (selectionKey.isReadable()) &#123;</span><br><span class="line">					SocketChannel channel = (SocketChannel) selectionKey.channel();</span><br><span class="line">					readBuffer.clear();</span><br><span class="line">					channel.read(readBuffer);</span><br><span class="line">					System.out.println(<span class="keyword">new</span> String(readBuffer.array()));</span><br><span class="line">				&#125;</span><br><span class="line">				it.remove();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>服务端</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	List&lt;SocketChannel&gt; socketChannels;</span><br><span class="line">	ServerSocketChannel ssc = <span class="keyword">null</span>;</span><br><span class="line">	Selector selector = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//存放所有客户端socketchannel，用于消息分发</span></span><br><span class="line">		socketChannels = <span class="keyword">new</span> ArrayList&lt;SocketChannel&gt;();</span><br><span class="line">		ssc = ServerSocketChannel.open();</span><br><span class="line">		ssc.socket().bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8888</span>));</span><br><span class="line">		selector = Selector.open();</span><br><span class="line">		ssc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">		ssc.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">		ByteBuffer buff = ByteBuffer.allocate(<span class="number">50</span>);</span><br><span class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">			selector.select();</span><br><span class="line">			Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();</span><br><span class="line">			Iterator&lt;SelectionKey&gt; it = selectedKeys.iterator();</span><br><span class="line">			<span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">				SelectionKey key = it.next();</span><br><span class="line">				<span class="keyword">if</span>(key.isAcceptable()) &#123;</span><br><span class="line">					ServerSocketChannel sscTemp = (ServerSocketChannel) key.channel();</span><br><span class="line">					SocketChannel sc = sscTemp.accept();</span><br><span class="line">					sc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">					sc.register(selector, SelectionKey.OP_READ);</span><br><span class="line">					socketChannels.add(sc);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(key.isReadable()) &#123;</span><br><span class="line">					</span><br><span class="line">					buff.clear();</span><br><span class="line">					SocketChannel sc = (SocketChannel) key.channel();</span><br><span class="line">					sc.read(buff);</span><br><span class="line">					<span class="comment">//消息分发</span></span><br><span class="line">					socketChannels.forEach(socketChannel-&gt;&#123;</span><br><span class="line">						<span class="keyword">if</span>(sc!=socketChannel) &#123;</span><br><span class="line">							<span class="keyword">try</span> &#123;</span><br><span class="line">								buff.flip();</span><br><span class="line">								socketChannel.write(buff);</span><br><span class="line">							&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">								<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">								e.printStackTrace();</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;);</span><br><span class="line">					System.out.println(<span class="keyword">new</span> String(buff.array()));</span><br><span class="line">					</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				it.remove();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="nio非阻塞特性"><a href="#nio非阻塞特性" class="headerlink" title="nio非阻塞特性"></a>nio非阻塞特性</h3><p>不用像io一样，因为读写都是阻塞的，所以对每个客户端连接都要建一个线程来监听，而nio只需要一个线程使用selector监听所有channel，减轻服务器负担</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/17/mysql%E4%B8%AD%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0%E5%92%8C%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sinaill">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/17/mysql%E4%B8%AD%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0%E5%92%8C%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" itemprop="url">mysql中的自定义函数和存储过程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-17T01:43:37+08:00">
                2020-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h3><h4 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h4><h5 id="创建函数"><a href="#创建函数" class="headerlink" title="创建函数"></a>创建函数</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">　　delimiter 自定义符号　　-- 如果函数体只有一条语句, begin和end可以省略, 同时delimiter也可以省略</span><br><span class="line"></span><br><span class="line">　　create function 函数名(形参列表) returns 返回类型　　-- 注意是retruns</span><br><span class="line"></span><br><span class="line">　　begin</span><br><span class="line"></span><br><span class="line">　　　　函数体　　　　-- 函数内定义的变量如：set @x &#x3D; 1; 变量x为全局变量，在函数外面也可以使用</span><br><span class="line"></span><br><span class="line">　　　　返回值</span><br><span class="line"></span><br><span class="line">　　end</span><br><span class="line"></span><br><span class="line">　　自定义符号</span><br><span class="line"></span><br><span class="line">　　delimiter ;</span><br></pre></td></tr></table></figure>

<h5 id="查看自定义函数"><a href="#查看自定义函数" class="headerlink" title="查看自定义函数"></a>查看自定义函数</h5><p><code>show function status [like &#39;pattern&#39;]</code>　　– 查看所有自定义函数, 自定义函数只能在本数据库使用</p>
<p><code>show create function</code> 函数名 – 查看函数创建语句</p>
<h5 id="删除函数"><a href="#删除函数" class="headerlink" title="删除函数"></a>删除函数</h5><p>drop function 函数名</p>
<h4 id="综合应用"><a href="#综合应用" class="headerlink" title="综合应用"></a>综合应用</h4><h5 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">create function myfun(变量名 类型) returns varchar(20)</span><br><span class="line">begin</span><br><span class="line">    return &quot;hello world&quot;;</span><br><span class="line">end</span><br><span class="line">$$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>


<h5 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">声明变量 DECLARE 变量名 类型 [default] [值]</span><br><span class="line"></span><br><span class="line">为变量赋值 select ··· into 变量名 或者 set 变量名 &#x3D; 值</span><br><span class="line"></span><br><span class="line">全局变量</span><br><span class="line">SET @变量名 &#x3D; 值</span><br></pre></td></tr></table></figure>


<h5 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h5><h6 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h6><p>IF语句用来进行条件判断。根据是否满足条件，将执行不同的语句。其语法的基本形式如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">IF search_condition THEN statement_list</span><br><span class="line">[ELSEIF search_condition THEN statement_list] …</span><br><span class="line">[ELSE statement_list]</span><br><span class="line">END IF</span><br></pre></td></tr></table></figure>

<h6 id="case语句"><a href="#case语句" class="headerlink" title="case语句"></a>case语句</h6><p>CASE语句也用来进行条件判断，其可以实现比IF语句更复杂的条件判断。CASE语句的基本形式如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CASE case_value </span><br><span class="line">WHEN when_value THEN statement_list </span><br><span class="line">[WHEN when_value THEN statement_list] ... </span><br><span class="line">[ELSE statement_list] </span><br><span class="line">END CASE</span><br></pre></td></tr></table></figure>

<p>CASE语句还有另一种形式。该形式的语法如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CASE </span><br><span class="line">WHEN search_condition THEN statement_list </span><br><span class="line">[WHEN search_condition THEN statement_list] ... </span><br><span class="line">[ELSE statement_list] </span><br><span class="line">END CASE</span><br></pre></td></tr></table></figure>

<h6 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h6><p>repeat:REPEAT语句是有条件控制的循环语句。当满足特定条件时，就会跳出循环语句。REPEAT语句的基本语法形式如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[label:] REPEAT </span><br><span class="line">statement_list </span><br><span class="line">UNTIL condition </span><br><span class="line">END REPEAT [label]</span><br></pre></td></tr></table></figure>

<p>while:WHILE语句是当满足条件时，执行循环内的语句。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[label:] WHILE search_condition DO </span><br><span class="line">statement_list </span><br><span class="line">END WHILE [label]</span><br></pre></td></tr></table></figure>

<p>loop:LOOP语句可以使某些特定的语句重复执行，实现一个简单的循环，但是LOOP语句本身没有停止循环的语句，必须是遇到LEAVE语句等才能停止循环。</p>
<p>LOOP语句的语法的基本形式如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[label:] LOOP </span><br><span class="line">statement_list </span><br><span class="line">if condition THEN LEAVE label</span><br><span class="line">END LOOP [label]</span><br></pre></td></tr></table></figure>

<p>ITERATE:ITERATE语句是跳出本次循环，然后直接进入下一次循环，和java中continue相同</p>
<p><code>ITERATE label</code></p>
<p>leave:LEAVE语句主要用于跳出循环控制。其语法形式如下：</p>
<p><code>LEAVE label</code></p>
<p>ITERATE和LEAVE除了和loop配合使用，还可以配合标签使用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">label1: BEGIN</span><br><span class="line">　　label2: BEGIN</span><br><span class="line">　　　　label3: BEGIN</span><br><span class="line">　　　　　　statements; </span><br><span class="line">　　　　END label3 ;</span><br><span class="line">　　END label2;</span><br><span class="line">END label1</span><br></pre></td></tr></table></figure>

<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><p>SQL语句需要先编译然后执行，而存储过程（Stored Procedure）是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行它。</p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><h5 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CREATE PROCEDURE 存储过程名([[IN |OUT |INOUT ] 参数名 数据类形...])</span><br><span class="line">begin</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>IN 输入参数：表示调用者向过程传入值（传入值可以是字面量或变量）</p>
<p>OUT 输出参数：表示过程向调用者传出值(可以返回多个值)（传出值只能是变量）</p>
<p>INOUT 输入输出参数：既表示调用者向过程传入值，又表示过程向调用者传出值（值只能是变量）</p>
<p>向存储过程传入用户变量，IN能接收到，但其对传入的值修改影响不了原来的值，OUT接收不到传入的变量，但对传入的值修改可以改变原来的值(传入的OUT类型的变量接收结果，相当于return)。INOUT兼具。<a href="http://www.runoob.com/w3cnote/mysql-stored-procedure.html" target="_blank" rel="noopener">http://www.runoob.com/w3cnote/mysql-stored-procedure.html</a></p>
<h5 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h5><p><code>CREATE PROCEDURE 存储过程名([[IN |OUT |INOUT ] 参数名 数据类形...])</code></p>
<h5 id="查看存储过程"><a href="#查看存储过程" class="headerlink" title="查看存储过程"></a>查看存储过程</h5><p><code>show procedure status where db=&#39;数据库名&#39;;</code></p>
<h5 id="综合应用-1"><a href="#综合应用-1" class="headerlink" title="综合应用"></a>综合应用</h5><p>hello world</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CREATE  PROCEDURE &#96;proc&#96;()</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT &#39;hello world&#39;;</span><br><span class="line">	</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<h5 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h5><p>与自定义函数相同</p>
<h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><ol>
<li>一般来说，存储过程实现的功能要复杂一点，而函数的实现的功能针对性比较强。存储过程，功能强大，可以执行包括修改表等一系列数据库操作；用户定义函数不能用于执行一组修改全局数据库状态的操作(insert，update，delete)。</li>
<li>存储过程一般是作为一个独立的部分来执行（EXEC执行），而函数可以作为查询语句的一个部分来调用(SELECT调用)。</li>
<li>自定义函数可以返回表变量</li>
<li>存储过程可以返回结果集</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/5/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">sinaill</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">85</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sinaill</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

  <link rel="stylesheet" href="/lib/prettify/skins/desert.css" type="text/css">
<script src="/lib/prettify/prettify.js" type="text/javascript"></script>
<script type="text/javascript">
  $(document).ready(function() {
      $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
      prettyPrint();
  });
</script>
</body>
</html>
